<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jermaine Barber's | Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>tailwind.config={theme:{extend:{colors:{gold:'#D4AF37',dark:'#09090b',card:'#18181b',border:'#27272a'}}}}</script>
    <style>
        * { font-family: 'Inter', system-ui, sans-serif; }
        .sidebar-item.active{background:linear-gradient(90deg,rgba(212,175,55,0.15) 0%,transparent 100%);border-left:3px solid #D4AF37;color:#D4AF37}
        .badge{padding:4px 10px;border-radius:20px;font-size:11px;font-weight:500}
        .badge-confirmed{background:rgba(34,197,94,0.15);color:#22c55e}
        .badge-pending{background:rgba(234,179,8,0.15);color:#eab308}
        .badge-completed{background:rgba(59,130,246,0.15);color:#3b82f6}
        @keyframes spin { to { transform: rotate(360deg); } }
        .spinner { animation: spin 1s linear infinite; }
    </style>
</head>
<body class="bg-dark text-white">
    
    <!-- ==================== AUTH SCREEN ==================== -->
    <div id="authScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md">
            <!-- Logo -->
            <div class="text-center mb-8">
                <div class="w-24 h-24 bg-gold rounded-2xl flex items-center justify-center mx-auto mb-4 text-dark text-5xl font-bold shadow-lg shadow-gold/20">JB</div>
                <h1 class="text-4xl text-gold tracking-wider font-bold">JERMAINE ADMIN</h1>
                <p class="text-zinc-500 text-sm mt-2">Panel de Administraci√≥n Seguro</p>
            </div>
            
            <!-- Auth Card -->
            <div class="bg-card border border-border rounded-2xl p-8">
                <!-- Tab Switcher -->
                <div class="flex mb-6 bg-dark rounded-lg p-1">
                    <button onclick="showAuthTab('login')" id="tabLogin" class="flex-1 py-2.5 rounded-md text-sm font-medium transition bg-gold text-dark">Iniciar Sesi√≥n</button>
                    <button onclick="showAuthTab('register')" id="tabRegister" class="flex-1 py-2.5 rounded-md text-sm font-medium transition text-zinc-400 hover:text-white">Registrarse</button>
                </div>

                <!-- Login Form -->
                <form id="loginForm" onsubmit="handleEmailLogin(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm text-zinc-400 mb-2">Email</label>
                        <input type="email" id="loginEmail" required placeholder="admin@jermaine.com" 
                            class="w-full bg-dark border border-border rounded-xl px-4 py-3.5 focus:outline-none focus:border-gold text-white transition">
                    </div>
                    <div>
                        <label class="block text-sm text-zinc-400 mb-2">Contrase√±a</label>
                        <div class="relative">
                            <input type="password" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                                class="w-full bg-dark border border-border rounded-xl px-4 py-3.5 pr-12 focus:outline-none focus:border-gold text-white transition">
                            <button type="button" onclick="togglePassword('loginPassword')" class="absolute right-4 top-1/2 -translate-y-1/2 text-zinc-500 hover:text-white">
                                <svg id="eyeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                            </button>
                        </div>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="rememberMe" class="w-4 h-4 rounded border-border bg-dark text-gold focus:ring-gold">
                            <span class="text-zinc-400">Recordarme</span>
                        </label>
                        <button type="button" onclick="showForgotPassword()" class="text-gold hover:underline">¬øOlvidaste tu contrase√±a?</button>
                    </div>
                    <button type="submit" id="loginBtn" class="w-full bg-gold text-dark font-semibold py-4 rounded-xl hover:opacity-90 transition text-lg flex items-center justify-center gap-2">
                        <span>Iniciar Sesi√≥n</span>
                    </button>
                </form>

                <!-- Register Form (Hidden by default) -->
                <form id="registerForm" onsubmit="handleRegister(event)" class="space-y-4 hidden">
                    <div>
                        <label class="block text-sm text-zinc-400 mb-2">Nombre Completo</label>
                        <input type="text" id="regName" required placeholder="Jermaine Smith" 
                            class="w-full bg-dark border border-border rounded-xl px-4 py-3.5 focus:outline-none focus:border-gold text-white">
                    </div>
                    <div>
                        <label class="block text-sm text-zinc-400 mb-2">Email</label>
                        <input type="email" id="regEmail" required placeholder="tu@email.com" 
                            class="w-full bg-dark border border-border rounded-xl px-4 py-3.5 focus:outline-none focus:border-gold text-white">
                    </div>
                    <div>
                        <label class="block text-sm text-zinc-400 mb-2">Contrase√±a</label>
                        <input type="password" id="regPassword" required minlength="8" placeholder="M√≠nimo 8 caracteres" 
                            class="w-full bg-dark border border-border rounded-xl px-4 py-3.5 focus:outline-none focus:border-gold text-white">
                    </div>
                    <div>
                        <label class="block text-sm text-zinc-400 mb-2">Confirmar Contrase√±a</label>
                        <input type="password" id="regPasswordConfirm" required placeholder="Repite tu contrase√±a" 
                            class="w-full bg-dark border border-border rounded-xl px-4 py-3.5 focus:outline-none focus:border-gold text-white">
                    </div>
                    <div>
                        <label class="block text-sm text-zinc-400 mb-2">C√≥digo de Invitaci√≥n</label>
                        <input type="text" id="regInviteCode" required placeholder="C√≥digo proporcionado por Jermaine" 
                            class="w-full bg-dark border border-border rounded-xl px-4 py-3.5 focus:outline-none focus:border-gold text-white">
                    </div>
                    <button type="submit" class="w-full bg-gold text-dark font-semibold py-4 rounded-xl hover:opacity-90 transition text-lg">
                        Crear Cuenta
                    </button>
                </form>

                <!-- Divider -->
                <div class="flex items-center gap-4 my-6">
                    <div class="flex-1 h-px bg-border"></div>
                    <span class="text-zinc-500 text-sm">o contin√∫a con</span>
                    <div class="flex-1 h-px bg-border"></div>
                </div>

                <!-- Google Sign In -->
                <button onclick="handleGoogleLogin()" id="googleBtn" class="w-full bg-white text-gray-800 font-medium py-3.5 rounded-xl hover:bg-gray-100 transition flex items-center justify-center gap-3">
                    <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    <span>Continuar con Google</span>
                </button>

                <!-- Security Notice -->
                <div class="mt-6 p-4 bg-dark rounded-xl border border-border">
                    <div class="flex items-start gap-3">
                        <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                        <div>
                            <p class="text-sm font-medium text-green-500">Conexi√≥n Segura</p>
                            <p class="text-xs text-zinc-500 mt-1">Tus datos est√°n protegidos con encriptaci√≥n SSL de 256 bits</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <p class="text-center text-zinc-600 text-xs mt-6">
                Powered by <span class="text-gold">MachineMind AI</span> ‚Ä¢ 
                <a href="#" class="hover:text-white">Privacidad</a> ‚Ä¢ 
                <a href="#" class="hover:text-white">T√©rminos</a>
            </p>
        </div>
    </div>

    <!-- ==================== FORGOT PASSWORD MODAL ==================== -->
    <div id="forgotModal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="bg-card border border-border rounded-2xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold">Recuperar Contrase√±a</h3>
                <button onclick="closeForgotPassword()" class="text-zinc-400 hover:text-white">‚úï</button>
            </div>
            <form onsubmit="handleForgotPassword(event)" class="space-y-4">
                <p class="text-zinc-400 text-sm">Ingresa tu email y te enviaremos un enlace para restablecer tu contrase√±a.</p>
                <input type="email" id="forgotEmail" required placeholder="tu@email.com" 
                    class="w-full bg-dark border border-border rounded-xl px-4 py-3.5 focus:outline-none focus:border-gold text-white">
                <button type="submit" class="w-full bg-gold text-dark font-semibold py-3.5 rounded-xl hover:opacity-90 transition">
                    Enviar Enlace
                </button>
            </form>
        </div>
    </div>

    <!-- ==================== 2FA MODAL ==================== -->
    <div id="twoFactorModal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="bg-card border border-border rounded-2xl max-w-md w-full p-6">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gold/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                </div>
                <h3 class="text-xl font-semibold">Verificaci√≥n en 2 Pasos</h3>
                <p class="text-zinc-400 text-sm mt-2">Ingresa el c√≥digo enviado a tu tel√©fono o email</p>
            </div>
            <form onsubmit="verify2FA(event)" class="space-y-4">
                <div class="flex gap-2 justify-center">
                    <input type="text" maxlength="1" class="w-12 h-14 bg-dark border border-border rounded-xl text-center text-2xl focus:outline-none focus:border-gold" oninput="moveToNext(this, 1)">
                    <input type="text" maxlength="1" class="w-12 h-14 bg-dark border border-border rounded-xl text-center text-2xl focus:outline-none focus:border-gold" oninput="moveToNext(this, 2)">
                    <input type="text" maxlength="1" class="w-12 h-14 bg-dark border border-border rounded-xl text-center text-2xl focus:outline-none focus:border-gold" oninput="moveToNext(this, 3)">
                    <input type="text" maxlength="1" class="w-12 h-14 bg-dark border border-border rounded-xl text-center text-2xl focus:outline-none focus:border-gold" oninput="moveToNext(this, 4)">
                    <input type="text" maxlength="1" class="w-12 h-14 bg-dark border border-border rounded-xl text-center text-2xl focus:outline-none focus:border-gold" oninput="moveToNext(this, 5)">
                    <input type="text" maxlength="1" class="w-12 h-14 bg-dark border border-border rounded-xl text-center text-2xl focus:outline-none focus:border-gold" oninput="moveToNext(this, 6)">
                </div>
                <button type="submit" class="w-full bg-gold text-dark font-semibold py-3.5 rounded-xl hover:opacity-90 transition">
                    Verificar
                </button>
                <p class="text-center text-sm text-zinc-500">
                    ¬øNo recibiste el c√≥digo? <button type="button" onclick="resend2FA()" class="text-gold hover:underline">Reenviar</button>
                </p>
            </form>
        </div>
    </div>

    <!-- ==================== MAIN DASHBOARD ==================== -->
    <div id="dashboard" class="hidden">
        <header class="fixed top-0 left-0 right-0 h-16 bg-dark/95 backdrop-blur border-b border-border z-50 flex items-center justify-between px-6">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar()" class="lg:hidden p-2">‚ò∞</button>
                <div class="w-9 h-9 bg-gold rounded-lg flex items-center justify-center text-dark font-bold">JB</div>
                <span class="text-xl font-bold hidden sm:block">JERMAINE ADMIN</span>
            </div>
            <div class="flex items-center gap-4">
                <div class="hidden sm:flex items-center gap-2 px-3 py-1.5 bg-green-500/10 border border-green-500/30 rounded-full">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                    <span class="text-green-500 text-xs font-medium">Sesi√≥n Segura</span>
                </div>
                <div class="flex items-center gap-3">
                    <img id="userAvatar" src="" alt="" class="w-9 h-9 bg-gold rounded-full hidden">
                    <div id="userInitial" class="w-9 h-9 bg-gold rounded-full flex items-center justify-center text-dark font-bold">J</div>
                    <div class="hidden sm:block">
                        <p id="userName" class="text-sm font-medium">Jermaine</p>
                        <p id="userRole" class="text-xs text-zinc-500">Administrador</p>
                    </div>
                </div>
                <div class="relative">
                    <button onclick="toggleUserMenu()" class="p-2 hover:bg-card rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                    </button>
                    <div id="userMenu" class="hidden absolute right-0 top-12 w-56 bg-card border border-border rounded-xl shadow-xl overflow-hidden">
                        <div class="p-4 border-b border-border">
                            <p id="menuUserName" class="font-medium">Jermaine</p>
                            <p id="menuUserEmail" class="text-sm text-zinc-500">admin@jermaine.com</p>
                        </div>
                        <div class="p-2">
                            <button onclick="showSection('settings')" class="w-full px-4 py-2.5 text-left text-sm hover:bg-white/5 rounded-lg flex items-center gap-3">
                                <svg class="w-4 h-4 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                                Configuraci√≥n
                            </button>
                            <button onclick="showSecuritySettings()" class="w-full px-4 py-2.5 text-left text-sm hover:bg-white/5 rounded-lg flex items-center gap-3">
                                <svg class="w-4 h-4 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                                Seguridad
                            </button>
                            <button onclick="viewActivityLog()" class="w-full px-4 py-2.5 text-left text-sm hover:bg-white/5 rounded-lg flex items-center gap-3">
                                <svg class="w-4 h-4 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
                                Registro de Actividad
                            </button>
                        </div>
                        <div class="p-2 border-t border-border">
                            <button onclick="handleLogout()" class="w-full px-4 py-2.5 text-left text-sm text-red-400 hover:bg-red-500/10 rounded-lg flex items-center gap-3">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
                                Cerrar Sesi√≥n
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <aside id="sidebar" class="fixed left-0 top-16 bottom-0 w-64 bg-card border-r border-border transform -translate-x-full lg:translate-x-0 transition-transform z-40 overflow-y-auto p-3">
            <div class="text-xs text-zinc-500 uppercase px-3 py-2">Principal</div>
            <button onclick="showSection('overview')" data-section="overview" class="sidebar-item active w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left text-sm hover:bg-white/5 mb-1">üìä Dashboard</button>
            <button onclick="showSection('bookings')" data-section="bookings" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left text-sm hover:bg-white/5 mb-1">üìÖ Reservas</button>
            <button onclick="showSection('clients')" data-section="clients" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left text-sm hover:bg-white/5 mb-1">üë• Clientes</button>
            <div class="text-xs text-zinc-500 uppercase px-3 py-2 mt-4">Finanzas</div>
            <button onclick="showSection('finances')" data-section="finances" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left text-sm hover:bg-white/5 mb-1">üìà P&L</button>
            <button onclick="showSection('expenses')" data-section="expenses" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left text-sm hover:bg-white/5 mb-1">üßæ Gastos</button>
            <button onclick="showSection('cashflow')" data-section="cashflow" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left text-sm hover:bg-white/5 mb-1">üí∞ Flujo Caja</button>
            <div class="text-xs text-zinc-500 uppercase px-3 py-2 mt-4">Operaciones</div>
            <button onclick="showSection('staff')" data-section="staff" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left text-sm hover:bg-white/5 mb-1">‚úÇÔ∏è Empleados</button>
            <button onclick="showSection('inventory')" data-section="inventory" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left text-sm hover:bg-white/5 mb-1">üì¶ Inventario</button>
            <button onclick="showSection('availability')" data-section="availability" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left text-sm hover:bg-white/5 mb-1">üïê Disponibilidad</button>
            <div class="text-xs text-zinc-500 uppercase px-3 py-2 mt-4">Sistema</div>
            <button onclick="showSection('gallery')" data-section="gallery" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left text-sm hover:bg-white/5 mb-1">üñºÔ∏è Galer√≠a</button>
            <button onclick="showSection('chatbot')" data-section="chatbot" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left text-sm hover:bg-white/5 mb-1">ü§ñ Sofia AI</button>
            <button onclick="showSection('security')" data-section="security" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left text-sm hover:bg-white/5 mb-1">üîí Seguridad</button>
            <button onclick="showSection('settings')" data-section="settings" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left text-sm hover:bg-white/5 mb-1">‚öôÔ∏è Config</button>
            <div class="mt-6 p-4 bg-gold/10 rounded-xl border border-gold/20"><p class="text-xs text-zinc-400 mb-1">Ingresos Hoy</p><p class="text-2xl font-bold text-gold">$485,000</p><p class="text-xs text-green-500">‚Üë 12%</p></div>
        </aside>

        <div id="sidebarOverlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-30 lg:hidden hidden"></div>

        <main class="lg:ml-64 pt-16 min-h-screen p-4 lg:p-6">
            <!-- OVERVIEW -->
            <section id="section-overview">
                <div class="mb-6"><h1 class="text-2xl font-bold">Buenos d√≠as, <span id="welcomeName">Jermaine</span> üëã</h1><p class="text-zinc-500">Jueves, 30 de Enero 2026</p></div>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-card border border-border rounded-xl p-5"><div class="w-10 h-10 bg-green-500/15 rounded-lg flex items-center justify-center text-green-500 mb-3">üíµ</div><p class="text-zinc-400 text-xs">Ingresos Hoy</p><p class="text-xl font-bold">$485,000</p></div>
                    <div class="bg-card border border-border rounded-xl p-5"><div class="w-10 h-10 bg-blue-500/15 rounded-lg flex items-center justify-center text-blue-500 mb-3">üìÖ</div><p class="text-zinc-400 text-xs">Citas Hoy</p><p class="text-xl font-bold">14 / 18</p></div>
                    <div class="bg-card border border-border rounded-xl p-5"><div class="w-10 h-10 bg-purple-500/15 rounded-lg flex items-center justify-center text-purple-500 mb-3">üë•</div><p class="text-zinc-400 text-xs">Clientes Nuevos</p><p class="text-xl font-bold">47</p></div>
                    <div class="bg-card border border-border rounded-xl p-5"><div class="w-10 h-10 bg-gold/15 rounded-lg flex items-center justify-center text-gold mb-3">‚≠ê</div><p class="text-zinc-400 text-xs">Rating</p><p class="text-xl font-bold">5.0 / 591</p></div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-card border border-border rounded-xl p-5"><h3 class="font-semibold mb-4">Ingresos vs Gastos</h3><canvas id="revenueChart" height="180"></canvas></div>
                    <div class="bg-card border border-border rounded-xl p-5"><h3 class="font-semibold mb-4">Servicios Populares</h3><canvas id="servicesChart" height="180"></canvas></div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 bg-card border border-border rounded-xl p-5">
                        <h3 class="font-semibold mb-4">Citas de Hoy</h3>
                        <table class="w-full text-sm"><thead><tr class="text-zinc-500 text-xs border-b border-border"><th class="text-left pb-3">Hora</th><th class="text-left pb-3">Cliente</th><th class="text-left pb-3">Servicio</th><th class="text-left pb-3">Estado</th><th class="text-right pb-3">Monto</th></tr></thead><tbody id="todayAppointments"></tbody></table>
                    </div>
                    <div class="space-y-4">
                        <h3 class="font-semibold">Acciones</h3>
                        <button onclick="openModal('bookingModal')" class="w-full bg-gold/10 border border-gold/30 rounded-xl p-4 text-left hover:bg-gold/20">‚ûï Nueva Reserva</button>
                        <button onclick="openModal('expenseModal')" class="w-full bg-card border border-border rounded-xl p-4 text-left hover:border-red-500/50">üßæ Registrar Gasto</button>
                        <button onclick="openModal('incomeModal')" class="w-full bg-card border border-border rounded-xl p-4 text-left hover:border-green-500/50">üí∞ Registrar Venta</button>
                    </div>
                </div>
            </section>

            <!-- BOOKINGS -->
            <section id="section-bookings" class="hidden">
                <div class="flex justify-between items-center mb-6"><h1 class="text-2xl font-bold">Reservas</h1><button onclick="openModal('bookingModal')" class="px-5 py-2.5 bg-gold text-dark font-semibold rounded-lg">‚ûï Nueva</button></div>
                <div class="bg-card border border-border rounded-xl overflow-hidden"><table class="w-full text-sm"><thead class="bg-dark/50"><tr class="text-zinc-400 text-xs"><th class="text-left p-4">ID</th><th class="text-left p-4">Fecha</th><th class="text-left p-4">Cliente</th><th class="text-left p-4">Servicio</th><th class="text-left p-4">Estado</th><th class="text-right p-4">Monto</th></tr></thead><tbody id="bookingsTableBody"></tbody></table></div>
            </section>

            <!-- CLIENTS -->
            <section id="section-clients" class="hidden">
                <div class="flex justify-between items-center mb-6"><h1 class="text-2xl font-bold">Clientes</h1><button onclick="openModal('clientModal')" class="px-5 py-2.5 bg-gold text-dark font-semibold rounded-lg">‚ûï Nuevo</button></div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="clientsGrid"></div>
            </section>

            <!-- FINANCES -->
            <section id="section-finances" class="hidden">
                <h1 class="text-2xl font-bold mb-6">P&L</h1>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-green-500/10 border border-green-500/30 rounded-xl p-5"><p class="text-green-400 text-xs">Ingresos</p><p class="text-2xl font-bold text-green-400">$12.4M</p></div>
                    <div class="bg-red-500/10 border border-red-500/30 rounded-xl p-5"><p class="text-red-400 text-xs">Gastos</p><p class="text-2xl font-bold text-red-400">$4.2M</p></div>
                    <div class="bg-gold/10 border border-gold/30 rounded-xl p-5"><p class="text-gold text-xs">Utilidad</p><p class="text-2xl font-bold text-gold">$8.2M</p></div>
                    <div class="bg-card border border-border rounded-xl p-5"><p class="text-zinc-400 text-xs">Caja</p><p class="text-2xl font-bold">$15.8M</p></div>
                </div>
            </section>

            <!-- EXPENSES -->
            <section id="section-expenses" class="hidden">
                <div class="flex justify-between items-center mb-6"><h1 class="text-2xl font-bold">Gastos</h1><button onclick="openModal('expenseModal')" class="px-5 py-2.5 bg-red-500 text-white font-semibold rounded-lg">‚ûï Nuevo</button></div>
                <div class="bg-card border border-border rounded-xl overflow-hidden"><table class="w-full text-sm"><thead class="bg-dark/50"><tr class="text-zinc-400 text-xs"><th class="text-left p-4">Fecha</th><th class="text-left p-4">Descripci√≥n</th><th class="text-left p-4">Categor√≠a</th><th class="text-right p-4">Monto</th></tr></thead><tbody id="expensesTableBody"></tbody></table></div>
            </section>

            <!-- CASHFLOW -->
            <section id="section-cashflow" class="hidden">
                <h1 class="text-2xl font-bold mb-6">Flujo de Caja</h1>
                <div class="grid grid-cols-3 gap-6 mb-6">
                    <div class="bg-green-500/10 border border-green-500/30 rounded-xl p-6"><p class="text-zinc-400 text-sm">Entradas</p><p class="text-3xl font-bold text-green-400">$12.4M</p></div>
                    <div class="bg-red-500/10 border border-red-500/30 rounded-xl p-6"><p class="text-zinc-400 text-sm">Salidas</p><p class="text-3xl font-bold text-red-400">$4.2M</p></div>
                    <div class="bg-gold/10 border border-gold/30 rounded-xl p-6"><p class="text-zinc-400 text-sm">Neto</p><p class="text-3xl font-bold text-gold">+$8.2M</p></div>
                </div>
                <div class="bg-card border border-border rounded-xl p-6"><canvas id="cashflowChart" height="200"></canvas></div>
            </section>

            <!-- STAFF -->
            <section id="section-staff" class="hidden">
                <h1 class="text-2xl font-bold mb-6">Empleados</h1>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="staffGrid"></div>
            </section>

            <!-- INVENTORY -->
            <section id="section-inventory" class="hidden">
                <h1 class="text-2xl font-bold mb-6">Inventario</h1>
                <div class="bg-card border border-border rounded-xl overflow-hidden"><table class="w-full text-sm"><thead class="bg-dark/50"><tr class="text-zinc-400 text-xs"><th class="text-left p-4">Producto</th><th class="text-center p-4">Stock</th><th class="text-right p-4">Precio</th><th class="text-center p-4">Estado</th></tr></thead><tbody id="inventoryTableBody"></tbody></table></div>
            </section>

            <!-- AVAILABILITY -->
            <section id="section-availability" class="hidden">
                <h1 class="text-2xl font-bold mb-6">Disponibilidad</h1>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="barberStatus"></div>
            </section>

            <!-- GALLERY -->
            <section id="section-gallery" class="hidden">
                <div class="flex justify-between items-center mb-6"><h1 class="text-2xl font-bold">Galer√≠a</h1><button onclick="uploadPhotos()" class="px-4 py-2 bg-gold text-dark rounded-lg font-semibold">üì∏ Subir</button></div>
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4" id="galleryGrid"></div>
            </section>

            <!-- CHATBOT -->
            <section id="section-chatbot" class="hidden">
                <h1 class="text-2xl font-bold mb-6">Sofia AI</h1>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-card border border-border rounded-xl p-5"><p class="text-zinc-400 text-xs">Conversaciones</p><p class="text-2xl font-bold">847</p></div>
                    <div class="bg-card border border-border rounded-xl p-5"><p class="text-zinc-400 text-xs">Reservas v√≠a Chat</p><p class="text-2xl font-bold text-green-400">234</p></div>
                    <div class="bg-card border border-border rounded-xl p-5"><p class="text-zinc-400 text-xs">Resoluci√≥n</p><p class="text-2xl font-bold text-gold">94%</p></div>
                    <div class="bg-card border border-border rounded-xl p-5"><p class="text-zinc-400 text-xs">Escaladas</p><p class="text-2xl font-bold">51</p></div>
                </div>
                <div class="bg-card border border-border rounded-xl p-6"><div class="flex justify-between mb-4"><h3 class="font-semibold">Base de Conocimiento</h3><button onclick="addKnowledge()" class="text-gold text-sm">+ Agregar</button></div><div class="space-y-3" id="knowledgeBase"></div></div>
            </section>

            <!-- SECURITY -->
            <section id="section-security" class="hidden">
                <h1 class="text-2xl font-bold mb-6">üîí Seguridad y Acceso</h1>
                
                <!-- Security Status -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-green-500/10 border border-green-500/30 rounded-xl p-5">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></span>
                            <span class="text-green-400 font-medium">Conexi√≥n Segura</span>
                        </div>
                        <p class="text-xs text-zinc-500">SSL/TLS Activo</p>
                    </div>
                    <div class="bg-card border border-border rounded-xl p-5">
                        <p class="text-zinc-400 text-xs mb-1">√öltima Sesi√≥n</p>
                        <p class="font-medium">Hoy, 9:45 AM</p>
                        <p class="text-xs text-zinc-500">Cartagena, Colombia</p>
                    </div>
                    <div class="bg-card border border-border rounded-xl p-5">
                        <p class="text-zinc-400 text-xs mb-1">M√©todo de Login</p>
                        <p class="font-medium" id="loginMethodDisplay">Email/Contrase√±a</p>
                    </div>
                </div>

                <!-- 2FA Settings -->
                <div class="bg-card border border-border rounded-xl p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="font-semibold">Autenticaci√≥n de 2 Factores (2FA)</h3>
                            <p class="text-sm text-zinc-500">A√±ade una capa extra de seguridad</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="toggle2FA" class="sr-only peer" onchange="toggle2FA()">
                            <div class="w-11 h-6 bg-zinc-700 peer-focus:ring-2 peer-focus:ring-gold rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-gold"></div>
                        </label>
                    </div>
                    <div id="2faSetup" class="hidden mt-4 p-4 bg-dark rounded-xl">
                        <p class="text-sm text-zinc-400 mb-4">Recibir√°s un c√≥digo de verificaci√≥n cada vez que inicies sesi√≥n</p>
                        <div class="flex gap-4">
                            <button class="flex-1 py-3 bg-card border border-border rounded-lg hover:border-gold transition text-sm">üì± SMS</button>
                            <button class="flex-1 py-3 bg-card border border-border rounded-lg hover:border-gold transition text-sm">üìß Email</button>
                            <button class="flex-1 py-3 bg-card border border-border rounded-lg hover:border-gold transition text-sm">üîê App</button>
                        </div>
                    </div>
                </div>

                <!-- Active Sessions -->
                <div class="bg-card border border-border rounded-xl p-6 mb-6">
                    <h3 class="font-semibold mb-4">Sesiones Activas</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-4 bg-dark rounded-xl">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center">üíª</div>
                                <div>
                                    <p class="font-medium">Chrome - MacBook Pro</p>
                                    <p class="text-xs text-zinc-500">Cartagena, Colombia ‚Ä¢ Sesi√≥n actual</p>
                                </div>
                            </div>
                            <span class="text-green-500 text-sm">‚óè Activa</span>
                        </div>
                        <div class="flex items-center justify-between p-4 bg-dark rounded-xl">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 bg-zinc-700 rounded-lg flex items-center justify-center">üì±</div>
                                <div>
                                    <p class="font-medium">Safari - iPhone 15</p>
                                    <p class="text-xs text-zinc-500">Hace 2 d√≠as ‚Ä¢ Cartagena</p>
                                </div>
                            </div>
                            <button class="text-red-400 text-sm hover:underline">Cerrar</button>
                        </div>
                    </div>
                </div>

                <!-- Activity Log -->
                <div class="bg-card border border-border rounded-xl p-6">
                    <h3 class="font-semibold mb-4">Registro de Actividad Reciente</h3>
                    <div class="space-y-3" id="activityLog">
                        <div class="flex items-center gap-4 p-3 bg-dark rounded-lg">
                            <span class="text-green-500">‚úì</span>
                            <div class="flex-1"><p class="text-sm">Inicio de sesi√≥n exitoso</p><p class="text-xs text-zinc-500">Hoy, 9:45 AM</p></div>
                        </div>
                        <div class="flex items-center gap-4 p-3 bg-dark rounded-lg">
                            <span class="text-blue-500">üìù</span>
                            <div class="flex-1"><p class="text-sm">Reserva #127 creada</p><p class="text-xs text-zinc-500">Hoy, 9:30 AM</p></div>
                        </div>
                        <div class="flex items-center gap-4 p-3 bg-dark rounded-lg">
                            <span class="text-yellow-500">‚öôÔ∏è</span>
                            <div class="flex-1"><p class="text-sm">Configuraci√≥n actualizada</p><p class="text-xs text-zinc-500">Ayer, 6:15 PM</p></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SETTINGS -->
            <section id="section-settings" class="hidden">
                <h1 class="text-2xl font-bold mb-6">Configuraci√≥n</h1>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-card border border-border rounded-xl p-6">
                        <h3 class="font-semibold mb-4">Negocio</h3>
                        <div class="space-y-4">
                            <div><label class="block text-sm text-zinc-400 mb-2">Nombre</label><input type="text" value="Jermaine Barber's" class="w-full bg-dark border border-border rounded-lg px-4 py-3"></div>
                            <div><label class="block text-sm text-zinc-400 mb-2">WhatsApp</label><input type="text" value="+57 318 132 6952" class="w-full bg-dark border border-border rounded-lg px-4 py-3"></div>
                        </div>
                    </div>
                    <div class="bg-card border border-border rounded-xl p-6">
                        <h3 class="font-semibold mb-4">Mi Cuenta</h3>
                        <div class="space-y-4">
                            <div><label class="block text-sm text-zinc-400 mb-2">Email</label><input type="email" id="settingsEmail" class="w-full bg-dark border border-border rounded-lg px-4 py-3"></div>
                            <button onclick="changePassword()" class="w-full py-3 border border-border rounded-lg hover:border-gold transition">Cambiar Contrase√±a</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- MODALS -->
    <div id="bookingModal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="bg-card border border-border rounded-2xl max-w-lg w-full p-6">
            <div class="flex justify-between items-center mb-6"><h3 class="text-xl font-semibold">Nueva Reserva</h3><button onclick="closeModal('bookingModal')" class="text-zinc-400">‚úï</button></div>
            <form onsubmit="createBooking(event)" class="space-y-4">
                <input type="text" required placeholder="Cliente" class="w-full bg-dark border border-border rounded-lg px-4 py-3">
                <input type="tel" required placeholder="Tel√©fono" class="w-full bg-dark border border-border rounded-lg px-4 py-3">
                <select required class="w-full bg-dark border border-border rounded-lg px-4 py-3"><option value="">Servicio...</option><option>Corte - $25,000</option><option>Fade - $30,000</option><option>Barba - $15,000</option></select>
                <div class="grid grid-cols-2 gap-4"><input type="date" required class="w-full bg-dark border border-border rounded-lg px-4 py-3"><input type="time" required class="w-full bg-dark border border-border rounded-lg px-4 py-3"></div>
                <div class="flex gap-3"><button type="button" onclick="closeModal('bookingModal')" class="flex-1 py-3 border border-border rounded-lg">Cancelar</button><button type="submit" class="flex-1 py-3 bg-gold text-dark font-semibold rounded-lg">Crear</button></div>
            </form>
        </div>
    </div>

    <div id="expenseModal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="bg-card border border-border rounded-2xl max-w-lg w-full p-6">
            <div class="flex justify-between items-center mb-6"><h3 class="text-xl font-semibold">Registrar Gasto</h3><button onclick="closeModal('expenseModal')" class="text-zinc-400">‚úï</button></div>
            <form onsubmit="createExpense(event)" class="space-y-4">
                <input type="text" required placeholder="Descripci√≥n" class="w-full bg-dark border border-border rounded-lg px-4 py-3">
                <select required class="w-full bg-dark border border-border rounded-lg px-4 py-3"><option value="">Categor√≠a...</option><option>N√≥mina</option><option>Arriendo</option><option>Insumos</option></select>
                <input type="number" required placeholder="Monto" class="w-full bg-dark border border-border rounded-lg px-4 py-3">
                <div class="flex gap-3"><button type="button" onclick="closeModal('expenseModal')" class="flex-1 py-3 border border-border rounded-lg">Cancelar</button><button type="submit" class="flex-1 py-3 bg-red-500 text-white font-semibold rounded-lg">Registrar</button></div>
            </form>
        </div>
    </div>

    <div id="incomeModal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="bg-card border border-border rounded-2xl max-w-lg w-full p-6">
            <div class="flex justify-between items-center mb-6"><h3 class="text-xl font-semibold">Registrar Ingreso</h3><button onclick="closeModal('incomeModal')" class="text-zinc-400">‚úï</button></div>
            <form onsubmit="createIncome(event)" class="space-y-4">
                <input type="text" required placeholder="Descripci√≥n" class="w-full bg-dark border border-border rounded-lg px-4 py-3">
                <input type="number" required placeholder="Monto" class="w-full bg-dark border border-border rounded-lg px-4 py-3">
                <div class="flex gap-3"><button type="button" onclick="closeModal('incomeModal')" class="flex-1 py-3 border border-border rounded-lg">Cancelar</button><button type="submit" class="flex-1 py-3 bg-green-500 text-white font-semibold rounded-lg">Registrar</button></div>
            </form>
        </div>
    </div>

    <div id="clientModal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="bg-card border border-border rounded-2xl max-w-lg w-full p-6">
            <div class="flex justify-between items-center mb-6"><h3 class="text-xl font-semibold">Nuevo Cliente</h3><button onclick="closeModal('clientModal')" class="text-zinc-400">‚úï</button></div>
            <form onsubmit="createClient(event)" class="space-y-4">
                <input type="text" required placeholder="Nombre" class="w-full bg-dark border border-border rounded-lg px-4 py-3">
                <input type="tel" required placeholder="Tel√©fono" class="w-full bg-dark border border-border rounded-lg px-4 py-3">
                <div class="flex gap-3"><button type="button" onclick="closeModal('clientModal')" class="flex-1 py-3 border border-border rounded-lg">Cancelar</button><button type="submit" class="flex-1 py-3 bg-gold text-dark font-semibold rounded-lg">Guardar</button></div>
            </form>
        </div>
    </div>

    <div id="toast" class="hidden fixed bottom-6 right-6 bg-green-500 text-white px-6 py-4 rounded-xl z-50">‚úì <span id="toastMessage">OK</span></div>

    <script>
        // ==================== CONFIG ====================
        const CONFIG = {
            GOOGLE_CLIENT_ID: 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com', // Replace with real client ID
            ALLOWED_EMAILS: ['jermaine@jermainebarbers.com', 'admin@jermainebarbers.com', 'sergio@machinemind.ai'],
            INVITE_CODES: ['JERMAINE2026', 'BARBER2026', 'MACHINEMIND'],
            SESSION_TIMEOUT: 30 * 60 * 1000, // 30 minutes
        };

        // ==================== DATA ====================
        const DB = {
            users: JSON.parse(localStorage.getItem('jermaine_users') || '[]'),
            bookings: [{id:1,date:'01-30',time:'09:00',client:'Juan P√©rez',service:'Fade',status:'completed',amount:30000},{id:2,date:'01-30',time:'09:45',client:'Miguel Torres',service:'Combo',status:'completed',amount:35000},{id:3,date:'01-30',time:'10:30',client:'Carlos Ruiz',service:'Corte',status:'confirmed',amount:25000},{id:4,date:'01-30',time:'11:00',client:'David Smith',service:'Fade',status:'confirmed',amount:30000},{id:5,date:'01-30',time:'11:30',client:'Pedro G√≥mez',service:'Barba',status:'pending',amount:15000}],
            clients: [{id:1,name:'Juan P√©rez',phone:'+57 300 123',visits:12,spent:420000,loyalty:2},{id:2,name:'Miguel Torres',phone:'+57 301 234',visits:8,spent:280000,loyalty:1},{id:3,name:'Carlos Ruiz',phone:'+57 302 345',visits:15,spent:525000,loyalty:3}],
            expenses: [{id:1,date:'01-30',description:'Productos',category:'Insumos',amount:450000},{id:2,date:'01-28',description:'N√≥mina',category:'N√≥mina',amount:1250000},{id:3,date:'01-15',description:'Arriendo',category:'Arriendo',amount:800000}],
            staff: [{id:1,name:'Carlos',role:'Senior',status:'available',bookings:5,revenue:175000},{id:2,name:'Miguel',role:'Barbero',status:'busy',bookings:4,revenue:140000},{id:3,name:'Andr√©s',role:'Barbero',status:'available',bookings:5,revenue:170000}],
            inventory: [{id:1,name:'Pomada Mate',stock:3,price:45000,min:5},{id:2,name:'Aceite Barba',stock:2,price:55000,min:5},{id:3,name:'Shampoo',stock:8,price:65000,min:5}],
            knowledge: [{id:1,trigger:'promociones',response:'üéâ 20% OFF en Combo!'},{id:2,trigger:'pago',response:'üí≥ Efectivo, Nequi, tarjetas'}],
            activityLog: []
        };

        // ==================== AUTH FUNCTIONS ====================
        let currentUser = null;
        let sessionTimer = null;

        function showAuthTab(tab) {
            document.getElementById('loginForm').classList.toggle('hidden', tab !== 'login');
            document.getElementById('registerForm').classList.toggle('hidden', tab !== 'register');
            document.getElementById('tabLogin').classList.toggle('bg-gold', tab === 'login');
            document.getElementById('tabLogin').classList.toggle('text-dark', tab === 'login');
            document.getElementById('tabLogin').classList.toggle('text-zinc-400', tab !== 'login');
            document.getElementById('tabRegister').classList.toggle('bg-gold', tab === 'register');
            document.getElementById('tabRegister').classList.toggle('text-dark', tab === 'register');
            document.getElementById('tabRegister').classList.toggle('text-zinc-400', tab !== 'register');
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        function handleEmailLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Demo login
            if ((email === 'admin@jermaine.com' && password === 'admin123') || 
                (email === 'jermaine@jermainebarbers.com' && password === 'barber2026')) {
                loginSuccess({ name: 'Jermaine', email: email, method: 'email' });
                return;
            }

            // Check registered users
            const user = DB.users.find(u => u.email === email && u.password === hashPassword(password));
            if (user) {
                loginSuccess(user);
            } else {
                showToast('‚ùå Credenciales incorrectas', 'error');
            }
        }

        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regPasswordConfirm').value;
            const inviteCode = document.getElementById('regInviteCode').value.toUpperCase();

            if (password !== confirmPassword) {
                showToast('‚ùå Las contrase√±as no coinciden', 'error');
                return;
            }

            if (!CONFIG.INVITE_CODES.includes(inviteCode)) {
                showToast('‚ùå C√≥digo de invitaci√≥n inv√°lido', 'error');
                return;
            }

            if (DB.users.find(u => u.email === email)) {
                showToast('‚ùå Este email ya est√° registrado', 'error');
                return;
            }

            const newUser = { id: Date.now(), name, email, password: hashPassword(password), method: 'email', createdAt: new Date().toISOString() };
            DB.users.push(newUser);
            localStorage.setItem('jermaine_users', JSON.stringify(DB.users));
            
            showToast('‚úÖ Cuenta creada exitosamente');
            showAuthTab('login');
            document.getElementById('loginEmail').value = email;
        }

        function handleGoogleLogin() {
            // For demo purposes - in production, use real Google OAuth
            showToast('üîó Conectando con Google...');
            setTimeout(() => {
                const mockGoogleUser = {
                    name: 'Jermaine (Google)',
                    email: 'jermaine@gmail.com',
                    picture: 'https://ui-avatars.com/api/?name=Jermaine&background=D4AF37&color=000',
                    method: 'google'
                };
                loginSuccess(mockGoogleUser);
            }, 1500);
        }

        function loginSuccess(user) {
            currentUser = user;
            logActivity('Inicio de sesi√≥n exitoso', 'login');
            
            // Store session
            const session = {
                user: user,
                loginTime: Date.now(),
                expiresAt: Date.now() + CONFIG.SESSION_TIMEOUT
            };
            localStorage.setItem('jermaine_session', JSON.stringify(session));
            
            // Update UI
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            
            // Update user info display
            document.getElementById('userName').textContent = user.name;
            document.getElementById('welcomeName').textContent = user.name.split(' ')[0];
            document.getElementById('menuUserName').textContent = user.name;
            document.getElementById('menuUserEmail').textContent = user.email;
            document.getElementById('settingsEmail').value = user.email;
            document.getElementById('loginMethodDisplay').textContent = user.method === 'google' ? 'Google' : 'Email/Contrase√±a';
            
            if (user.picture) {
                document.getElementById('userAvatar').src = user.picture;
                document.getElementById('userAvatar').classList.remove('hidden');
                document.getElementById('userInitial').classList.add('hidden');
            } else {
                document.getElementById('userInitial').textContent = user.name.charAt(0).toUpperCase();
            }
            
            // Start session timer
            startSessionTimer();
            
            // Initialize dashboard
            initDashboard();
            
            showToast('‚úÖ Bienvenido, ' + user.name);
        }

        function handleLogout() {
            logActivity('Cierre de sesi√≥n', 'logout');
            currentUser = null;
            localStorage.removeItem('jermaine_session');
            clearTimeout(sessionTimer);
            
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('userMenu').classList.add('hidden');
            
            showToast('üëã Sesi√≥n cerrada');
        }

        function startSessionTimer() {
            clearTimeout(sessionTimer);
            sessionTimer = setTimeout(() => {
                showToast('‚è∞ Sesi√≥n expirada por inactividad', 'warning');
                handleLogout();
            }, CONFIG.SESSION_TIMEOUT);
        }

        function resetSessionTimer() {
            if (currentUser) startSessionTimer();
        }

        function hashPassword(password) {
            // Simple hash for demo - use bcrypt in production
            return btoa(password);
        }

        function showForgotPassword() {
            document.getElementById('forgotModal').classList.remove('hidden');
        }

        function closeForgotPassword() {
            document.getElementById('forgotModal').classList.add('hidden');
        }

        function handleForgotPassword(e) {
            e.preventDefault();
            const email = document.getElementById('forgotEmail').value;
            showToast('üìß Enlace enviado a ' + email);
            closeForgotPassword();
        }

        function verify2FA(e) {
            e.preventDefault();
            showToast('‚úÖ C√≥digo verificado');
            document.getElementById('twoFactorModal').classList.add('hidden');
        }

        function resend2FA() {
            showToast('üì± C√≥digo reenviado');
        }

        function moveToNext(input, index) {
            if (input.value && index < 6) {
                input.nextElementSibling?.focus();
            }
        }

        function toggle2FA() {
            const setup = document.getElementById('2faSetup');
            const toggle = document.getElementById('toggle2FA');
            setup.classList.toggle('hidden', !toggle.checked);
        }

        function toggleUserMenu() {
            document.getElementById('userMenu').classList.toggle('hidden');
        }

        function logActivity(action, type) {
            DB.activityLog.unshift({
                action,
                type,
                timestamp: new Date().toISOString(),
                user: currentUser?.email
            });
        }

        // Check existing session on load
        function checkSession() {
            const sessionData = localStorage.getItem('jermaine_session');
            if (sessionData) {
                const session = JSON.parse(sessionData);
                if (session.expiresAt > Date.now()) {
                    loginSuccess(session.user);
                    return;
                }
                localStorage.removeItem('jermaine_session');
            }
        }

        // ==================== UI FUNCTIONS ====================
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('-translate-x-full');
            document.getElementById('sidebarOverlay').classList.toggle('hidden');
        }

        function showSection(s) {
            resetSessionTimer();
            document.querySelectorAll('main>section').forEach(x => x.classList.add('hidden'));
            document.getElementById('section-' + s)?.classList.remove('hidden');
            document.querySelectorAll('.sidebar-item').forEach(x => {
                x.classList.remove('active');
                if (x.dataset.section === s) x.classList.add('active');
            });
            if (window.innerWidth < 1024) toggleSidebar();
            document.getElementById('userMenu').classList.add('hidden');
            initSection(s);
        }

        function initSection(s) {
            switch(s) {
                case 'bookings': renderBookings(); break;
                case 'clients': renderClients(); break;
                case 'expenses': renderExpenses(); break;
                case 'staff': renderStaff(); break;
                case 'inventory': renderInventory(); break;
                case 'availability': renderAvailability(); break;
                case 'gallery': renderGallery(); break;
                case 'chatbot': renderKnowledge(); break;
                case 'cashflow': initCashflow(); break;
            }
        }

        function openModal(id) { resetSessionTimer(); document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        
        function showToast(m, type = 'success') {
            const t = document.getElementById('toast');
            t.className = `fixed bottom-6 right-6 px-6 py-4 rounded-xl z-50 ${type === 'error' ? 'bg-red-500' : type === 'warning' ? 'bg-yellow-500' : 'bg-green-500'} text-white`;
            document.getElementById('toastMessage').textContent = m.replace(/^[‚úì‚ùåüìßüîó‚è∞üëãüì±‚úÖ]+ /, '');
            t.classList.remove('hidden');
            setTimeout(() => t.classList.add('hidden'), 3000);
        }

        // ==================== DASHBOARD ====================
        function initDashboard() {
            renderToday();
            initCharts();
        }

        function renderToday() {
            document.getElementById('todayAppointments').innerHTML = DB.bookings.slice(0, 5).map(b => '<tr class="border-b border-border/50"><td class="py-3">' + b.time + '</td><td class="py-3">' + b.client + '</td><td class="py-3">' + b.service + '</td><td class="py-3"><span class="badge badge-' + b.status + '">' + (b.status === 'confirmed' ? 'Confirmada' : b.status === 'completed' ? 'Completada' : 'Pendiente') + '</span></td><td class="py-3 text-right font-medium">$' + b.amount.toLocaleString() + '</td></tr>').join('');
        }

        function initCharts() {
            const r = document.getElementById('revenueChart');
            if (r) new Chart(r, { type: 'bar', data: { labels: ['L', 'M', 'X', 'J', 'V', 'S', 'D'], datasets: [{ label: 'Ingresos', data: [420, 380, 450, 485, 520, 680, 0], backgroundColor: 'rgba(212,175,55,0.8)', borderRadius: 6 }, { label: 'Gastos', data: [150, 80, 120, 200, 100, 150, 0], backgroundColor: 'rgba(239,68,68,0.6)', borderRadius: 6 }] }, options: { responsive: true, plugins: { legend: { labels: { color: '#a1a1aa' } } }, scales: { y: { grid: { color: '#27272a' }, ticks: { color: '#a1a1aa' } }, x: { grid: { display: false }, ticks: { color: '#a1a1aa' } } } } });
            const s = document.getElementById('servicesChart');
            if (s) new Chart(s, { type: 'doughnut', data: { labels: ['Fade', 'Combo', 'Corte', 'Barba'], datasets: [{ data: [35, 25, 20, 12], backgroundColor: ['#D4AF37', '#3b82f6', '#22c55e', '#a855f7'], borderWidth: 0 }] }, options: { responsive: true, plugins: { legend: { position: 'right', labels: { color: '#a1a1aa' } } } } });
        }

        function initCashflow() {
            const c = document.getElementById('cashflowChart');
            if (c && !c.chart) {
                c.chart = new Chart(c, { type: 'line', data: { labels: Array.from({ length: 30 }, (_, i) => i + 1), datasets: [{ label: 'Flujo', data: Array.from({ length: 30 }, (_, d) => 8000 + d * 270), borderColor: '#D4AF37', backgroundColor: 'rgba(212,175,55,0.1)', fill: true, tension: 0.3 }] }, options: { responsive: true, plugins: { legend: { labels: { color: '#a1a1aa' } } }, scales: { y: { grid: { color: '#27272a' }, ticks: { color: '#a1a1aa' } }, x: { grid: { display: false }, ticks: { color: '#a1a1aa' } } } } });
            }
        }

        function renderBookings() { document.getElementById('bookingsTableBody').innerHTML = DB.bookings.map(b => '<tr class="border-b border-border/50"><td class="p-4">#' + b.id + '</td><td class="p-4">' + b.date + ' ' + b.time + '</td><td class="p-4">' + b.client + '</td><td class="p-4">' + b.service + '</td><td class="p-4"><span class="badge badge-' + b.status + '">' + (b.status === 'confirmed' ? 'Confirmada' : b.status === 'completed' ? 'Completada' : 'Pendiente') + '</span></td><td class="p-4 text-right">$' + b.amount.toLocaleString() + '</td></tr>').join(''); }
        function renderClients() { document.getElementById('clientsGrid').innerHTML = DB.clients.map(c => '<div class="bg-card border border-border rounded-xl p-5"><div class="flex items-start gap-4"><div class="w-12 h-12 bg-gold rounded-full flex items-center justify-center text-dark font-semibold">' + c.name.charAt(0) + '</div><div class="flex-1"><h4 class="font-semibold">' + c.name + '</h4><p class="text-sm text-zinc-500">' + c.phone + '</p></div></div><div class="mt-4 pt-4 border-t border-border grid grid-cols-2 gap-2 text-center text-sm"><div><p class="text-zinc-500">Visitas</p><p class="font-semibold">' + c.visits + '</p></div><div><p class="text-zinc-500">Gastado</p><p class="font-semibold text-green-400">$' + (c.spent / 1000).toFixed(0) + 'K</p></div></div></div>').join(''); }
        function renderExpenses() { document.getElementById('expensesTableBody').innerHTML = DB.expenses.map(e => '<tr class="border-b border-border/50"><td class="p-4">' + e.date + '</td><td class="p-4">' + e.description + '</td><td class="p-4"><span class="badge bg-zinc-700">' + e.category + '</span></td><td class="p-4 text-right text-red-400">-$' + e.amount.toLocaleString() + '</td></tr>').join(''); }
        function renderStaff() { document.getElementById('staffGrid').innerHTML = DB.staff.map(s => '<div class="bg-card border border-border rounded-xl p-6"><div class="flex items-center gap-4 mb-4"><div class="w-14 h-14 bg-' + (s.status === 'available' ? 'green' : 'yellow') + '-500 rounded-full flex items-center justify-center text-white font-bold text-xl">' + s.name.charAt(0) + '</div><div><h4 class="font-semibold">' + s.name + '</h4><p class="text-sm text-zinc-500">' + s.role + '</p><p class="text-xs ' + (s.status === 'available' ? 'text-green-500' : 'text-yellow-500') + '">‚óè ' + (s.status === 'available' ? 'Disponible' : 'Ocupado') + '</p></div></div><div class="space-y-2 text-sm"><div class="flex justify-between"><span class="text-zinc-500">Citas</span><span>' + s.bookings + '</span></div><div class="flex justify-between"><span class="text-zinc-500">Ingresos</span><span class="text-green-400">$' + s.revenue.toLocaleString() + '</span></div></div></div>').join(''); }
        function renderInventory() { document.getElementById('inventoryTableBody').innerHTML = DB.inventory.map(p => '<tr class="border-b border-border/50"><td class="p-4">' + p.name + '</td><td class="p-4 text-center ' + (p.stock <= p.min ? 'text-red-400 font-bold' : '') + '">' + p.stock + '</td><td class="p-4 text-right">$' + p.price.toLocaleString() + '</td><td class="p-4 text-center">' + (p.stock <= p.min ? '<span class="badge bg-red-500/20 text-red-400">Bajo</span>' : '<span class="badge bg-green-500/20 text-green-400">OK</span>') + '</td></tr>').join(''); }
        function renderAvailability() { document.getElementById('barberStatus').innerHTML = DB.staff.map(s => '<div class="bg-card border border-border rounded-xl p-5"><div class="flex items-center gap-3 mb-4"><div class="w-12 h-12 bg-' + (s.status === 'available' ? 'green' : 'yellow') + '-500 rounded-full flex items-center justify-center text-white font-bold">' + s.name.charAt(0) + '</div><div><p class="font-semibold">' + s.name + '</p><p class="text-sm ' + (s.status === 'available' ? 'text-green-500' : 'text-yellow-500') + '">‚óè ' + (s.status === 'available' ? 'Disponible' : 'Ocupado') + '</p></div></div></div>').join(''); }
        function renderGallery() { const e = ['üíà', '‚úÇÔ∏è', 'üßî', 'üíá', 'ü™í', 'üíÜ']; document.getElementById('galleryGrid').innerHTML = e.map(x => '<div class="aspect-square bg-gold/10 rounded-xl flex items-center justify-center text-4xl border border-border hover:border-gold cursor-pointer">' + x + '</div>').join(''); }
        function renderKnowledge() { document.getElementById('knowledgeBase').innerHTML = DB.knowledge.map(k => '<div class="bg-dark rounded-xl p-4 border border-border"><p class="text-sm text-zinc-400 mb-1">Trigger: <span class="text-gold">' + k.trigger + '</span></p><p class="text-sm">' + k.response + '</p></div>').join(''); }

        // Form handlers
        function createBooking(e) { e.preventDefault(); logActivity('Reserva creada', 'booking'); showToast('‚úÖ Reserva creada'); closeModal('bookingModal'); e.target.reset(); }
        function createExpense(e) { e.preventDefault(); logActivity('Gasto registrado', 'expense'); showToast('‚úÖ Gasto registrado'); closeModal('expenseModal'); e.target.reset(); }
        function createIncome(e) { e.preventDefault(); logActivity('Ingreso registrado', 'income'); showToast('‚úÖ Ingreso registrado'); closeModal('incomeModal'); e.target.reset(); }
        function createClient(e) { e.preventDefault(); logActivity('Cliente creado', 'client'); showToast('‚úÖ Cliente guardado'); closeModal('clientModal'); e.target.reset(); }
        function addKnowledge() { const t = prompt('Palabra clave:'); if (!t) return; const r = prompt('Respuesta:'); if (!r) return; DB.knowledge.push({ id: Date.now(), trigger: t, response: r }); renderKnowledge(); showToast('‚úÖ Agregado'); }
        function uploadPhotos() { const i = document.createElement('input'); i.type = 'file'; i.multiple = true; i.accept = 'image/*'; i.onchange = () => { logActivity('Fotos subidas', 'upload'); showToast('‚úÖ ' + i.files.length + ' foto(s) subidas'); }; i.click(); }
        function changePassword() { showToast('üìß Enlace de cambio enviado a tu email'); }
        function showSecuritySettings() { showSection('security'); }
        function viewActivityLog() { showSection('security'); }

        // Activity tracking
        document.addEventListener('click', resetSessionTimer);
        document.addEventListener('keypress', resetSessionTimer);

        // Initialize
        checkSession();
    </script>
</body>
</html>
